<!DOCTYPE html>
<html lang='zh-TW'>
  <head>
  <title>è¨˜å¸³å°å¹«æ‰‹ğŸ™‚</title>
	<meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
    <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css' integrity='sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO' crossorigin='anonymous'>
    
	<script src='https://code.jquery.com/jquery-3.3.1.min.js' crossorigin='anonymous'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js' integrity='sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49' crossorigin='anonymous'></script>
    <script src='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js' integrity='sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy' crossorigin='anonymous'></script>
    
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
      .row{
        margin-bottom: 20px;
      }
      .input-error{
        border: 1px solid #f00;
      }
	  	button.del{
			color:#999999;
			background-color: #e9f2f8 ;
			border:0px none;
		}
		
		button.del:hover {
			color:red;
			background-color: #e9f2f8 ;
			border:0px blue;
		}
		

    </style>
  </head>
  <body style="background-color:#e9f2f8">
		<div style="background-color:#ffee61e0;">
			<br>
			  <div class='row'>
				<div class='col-1' style="text-align:left;" ></div>
				<div class='col-7' style="text-align:left;" ><h1>ğŸ™‚ è¨˜å¸³å°å¹«æ‰‹</h1></div>
				<div class='col-3' style="text-align:right;"><h5>ğŸ‘¦ã€€<br/>æ¸¸åšç¿”</h5></div>
				<div class='col-1' style="text-align:left;" ></div>
			  </div>
			  <!--æ–°å¢---------------------------------------------------->
			  <div class='row'>
				<div class='col-1' style="text-align:left;" ></div>
				<!--é¤˜é¡---------------------------------------------------->
				<div class='col-6'><p class='lead' id='total'></p></div>
				<div class='col-4'><button class='btn btn-info float-right' id='addBtn'>æ–°å¢</button></div>
				<div class='col-1' style="text-align:left;" ></div>	
			  </div>
		</div>

    <div class='container'>
      <!--è¨˜å¸³---------------------------------------------------->
		
      <!--é¤˜é¡---------------------------------------------------->

      <!--è¡¨é ­---------------------------------------------------->
      <div class='row'>
        <table class='table' id='table1'>
          <tr><th>âŒšæ™‚é–“</th><th>ğŸ’´æ”¶æ”¯</th><th>ğŸ“Šé …ç›®</th><th>ğŸ’°é‡‘é¡</th><th>ğŸ“å‚™è¨»</th><th></th></tr>
        </table>
      </div>
      <!------------------------------------------------------>
      <div class='modal fade' id='dialog1' tabindex='-1' role='dialog' aria-labelledby='dialog1-title' aria-hidden='true'>
        <div class='modal-dialog modal-dialog-centered' role='document' >
          <div class='modal-content' style="background-color:#d4d4d4db">
            <div class='modal-header'>
              <h2 class='modal-title' id='dialog1-title'>æ–°å¢ä¸€ç­†æ”¶æ”¯è¨˜éŒ„</h2>
              <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
                <span aria-hidden='true'>&times;</span>
              </button>
            </div>
            <div class='modal-body'>
              <form name="myForm">
			  <!--form---------------------------------------------------->
 
                <div class='form-group row'>
                  <label for='staticEmail' class='col-sm-3 col-form-label'>âŒšæ™‚é–“</label>
                  <div class='col-sm-9'>
					<select name="year" id="year">
						<option value=2016>2016</option><option value=2017>2017</option><option value=2018>2018</option><option value=2019>2019</option><option value=2020>2020</option>
					</select>å¹´
					<select name="month" id="month" >
						<option value=1>1</option><option value=2>2</option><option value=3>3</option><option value=4>4</option>
						<option value=5>5</option><option value=6>6</option><option value=7>7</option><option value=8>8</option>
						<option value=9>9</option><option value=10>10</option><option value=11>11</option><option value=12>12</option>
					</select>æœˆ
					<select name="day" id="day">
						<option value=1>1</option><option value=2>2</option><option value=3>3</option><option value=4>4</option><option value=5>5</option>
						<option value=6>6</option><option value=7>7</option><option value=8>8</option><option value=9>9</option><option value=10>10</option>
						<option value=11>11</option><option value=12>12</option><option value=13>13</option><option value=14>14</option><option value=15>15</option>
						<option value=16>16</option><option value=17>17</option><option value=18>18</option><option value=19>19</option><option value=20>20</option>
						<option value=21>21</option><option value=22>22</option><option value=23>23</option><option value=24>24</option><option value=25>25</option>
						<option value=26>26</option><option value=27>27</option><option value=28>28</option>
						<option value=29>29</option><option value=30>30</option><option value=31>31</option>						
					</select>æ—¥
                  </div>
                </div>
					
					
                <div class='form-group row'>
                  <label for='staticEmail' class='col-sm-3 col-form-label'>ğŸ’´æ”¶æ”¯</label>
                  <div class='col-sm-9'>
					<input type="radio" name="type"  value="æ”¶å…¥" onChange="renew(0);">ã€€æ”¶å…¥ã€€
					<input type="radio" name="type"  value="æ”¯å‡º" onChange="renew(1);">ã€€æ”¯å‡ºã€€
				  </div>
                </div>
				

					<script>
					var poi=new Array();
					poi[0]=["å®¶æ•™","æ•™å­¸è–ªè³‡","ç ”ç©¶è¨ˆç•«","åŠ©æ•™è–ªè³‡","å·¥è®€é‡‘","å…¶ä»–"];	
					poi[1]=["æ­£é¤é¤è²»","é›¶é£Ÿé£²æ–™","æ—¥ç”¨å“","äº¤é€šè²»","å¨›æ¨‚ç¤¾äº¤","å…¶ä»–"];	
					poi[2]=["è«‹å…ˆé¸æ“‡æ”¶å…¥æˆ–æ”¯å‡º"]
					function renew(index){
						for(var i=0;i<poi[index].length;i++)
							document.myForm.selection.options[i]=new Option(poi[index][i]);	// è¨­å®šæ–°é¸é …
						document.myForm.selection.length=poi[index].length;	// åˆªé™¤å¤šé¤˜çš„é¸é …
					}
					</script>

                <div class='form-group row'>
                  <label for='staticEmail' class='col-sm-3 col-form-label'>ğŸ“Šé …ç›®</label>
                  <div class='col-sm-9'>
					<select name="selection" id="selection" size=6>
						<option value="">è«‹å…ˆé¸æ“‡æ”¶å…¥æˆ–æ”¯å‡º
					</select>
                  </div>
                </div>
				
                <div class='form-group row'>
                  <label for='inputPassword' class='col-sm-3 col-form-label'>ğŸ’°é‡‘é¡</label>
                  <div class='col-sm-9'>
                    <input type='text' class='form-control' id='cost' onkeypress="if (event.keyCode == 13) {return false;}">
                  </div>
                </div>
				
                <div class='form-group row'>
                  <label for='inputPassword' class='col-sm-3 col-form-label'>ğŸ“å‚™è¨»</label>
                  <div class='col-sm-9'>
                    <textarea class='form-control' id='note' rows='5'></textarea>
                  </div>
                </div>
				
			  <!--form-end------------------------------------------------>
              </form>
            </div>
            <div class='modal-footer'>
              <button type='button' class='btn btn-secondary' id='cancel' data-dismiss='modal'>å–æ¶ˆ</button>
              <button type='button' class='btn btn-primary' id='saveBtn'>å„²å­˜</button>
            </div>
          </div>
        </div>
      </div>
      <!------------------------------------------------------>
      <script>
        var items=[]; //all data put here
		var add=[0,0,0,0,0,0];
		var minus=[0,0,0,0,0,0];
		
		function formatDate(date) {  //æ—¥æœŸè¼¸å‡ºæ ¼å¼
          var Y = date.getFullYear();
          var M = date.getMonth()+1;
          var D = date.getDate();
          return Y+'/'+M+'/'+D;
        }
		
		$("#cost").keypress(function(e){ //é‡‘é¡æŒ‰enterå°±è‡ªå‹•é€å‡º
		  code = (e.keyCode ? e.keyCode : e.which);
		  if (code == 13) {$('#saveBtn').click();}});
		  

		
		function updateTable(){ //æ›´æ–°è³‡æ–™
          var result=new Number(0);
		  add=[0,0,0,0,0,0];
		  minus=[0,0,0,0,0,0];
          $('#table1 tr').remove();   //å…ˆæŠŠæ•´å€‹è¡¨å–®ç§»é™¤
		  $('#table1').append($('<tr><th>âŒšæ™‚é–“</th><th>ğŸ’´æ”¶æ”¯</th><th>ğŸ“Šé …ç›®</th><th>ğŸ’°é‡‘é¡</th><th>ğŸ“å‚™è¨»</th></tr>'));
          for(i in items){     //get all data to create a table and its contents
            $('#table1').append(
              $('<tr />').append($('<td />').addClass('time').html(formatDate(new Date(items[i].time))))
						 .append($('<td />').addClass('type').html(items[i].type))
						 .append($('<td />').addClass('selection').html(items[i].selection))
                         .append($('<td />').addClass('cost').html(items[i].cost))
                         .append($('<td />').html(items[i].note))
						 //.append($('<td />').append($('<button type="button" class="del">&times;</button>')))
            );
			var ct=new Number(items[i].cost);
			if(items[i].type=="æ”¶å…¥"){for(var k=0; k<6;k++){if(items[i].selection==poi[0][k]) {add[k]+=ct;result+=ct;}}}
			else					 {for(var k=0; k<6;k++){if(items[i].selection==poi[1][k]) {minus[k]+=ct;result-=ct;}}}
          }
		  
		  /*$(".del").click(function(){  //æŒ‰æ¯ä¸€åˆ—åˆªé™¤çš„xéµï¼Œå°‡itemè³‡æ–™åˆªé™¤è©²åˆ—ï¼Œå†æ›´æ–°ä¸€æ¬¡
		    items.splice(this.parentNode.parentNode.rowIndex-1,1);
			updateTable();
		  });/**/
		  
		  //æ›´æ–°é¤˜é¡èˆ‡ç•«åœ–
		  $('#total').html('ã€€ğŸ’µ é¤˜é¡ï¼š'+result);
		  google.charts.setOnLoadCallback(drawChart);
		  google.charts.setOnLoadCallback(drawChart2);
		                                
		  }		 
		  
		  
		function loadData(){    //load data via ajax
          $.ajax({
            url: "ass6_load.php",
            dataType:"json",
            success: function(res){
              items=res;
			  updateTable();    //updata after obtaining data from DB
            }
          });
        }

        function saveData(item){    //save data by ajax 
          $.ajax({
            url: "ass6_save.php",
            type: "post",
            data: item,
            success: function(result){
              loadData();  //load data by ajax
            }
          });
        }		
	
        $(function(){
			loadData();
		//add
          $('#addBtn').click(function(){
            $('#dialog1').modal('show');
			$('#year').val(new Date().getFullYear());
			$('#month').val(new Date().getMonth()+1);
			$('#day').val(new Date().getDate());
		  });
		

		  
		//save
		  $('#saveBtn').click(function(){
            
			//å–å¾—è¡¨å–®è³‡æ–™
            var time=Date.parse($('#year').val()+'/'+$('#month').val()+'/'+$('#day').val());
			var YR=$('#year').val();
			var MON=$('#month').val();
			var DAY=$('#day').val();
            var type=$("input[name=type]:checked").val();
            var selection=$('#selection').val();
            var cost=new Number($('#cost').val());
            var note=$('#note').val();

			//é˜²å‘†
			if(isNaN(time)){alert("æé†’ï¼šæ—¥æœŸæ ¼å¼éŒ¯èª¤ï¼");return;}
			if(MON==2||MON==4||MON==6||MON==9||MON==11){if(DAY==31){alert("æé†’ï¼šæ—¥æœŸæ ¼å¼éŒ¯èª¤ï¼");return;}}
			if(MON==2){if(DAY==30){alert("æé†’ï¼šæ—¥æœŸæ ¼å¼éŒ¯èª¤ï¼");return;}}
			if(MON==2&&!YR%4==0){if(DAY==29){alert("æé†’ï¼šæ—¥æœŸæ ¼å¼éŒ¯èª¤ï¼");return;}}
			if(!myForm.type[0].checked && !myForm.type[1].checked){alert("æé†’ï¼šè«‹é¸æ“‡æ”¶å…¥æˆ–æ”¯å‡ºï¼");return;}
			if(selection==null){alert("æé†’ï¼šè«‹é¸æ“‡é …ç›®ï¼");return;}
			if(isNaN(cost)){alert("æé†’ï¼šé‡‘é¡è«‹è¼¸å…¥æ­£æ•´æ•¸ï¼");return;}
			if(cost<=0){alert("æé†’ï¼šè¼¸å…¥é‡‘é¡ä¸å¾—ç‚ºè² æ•¸ã€0æˆ–ç©ºç™½ï¼");return;}
			if(!((cost | 0) == cost)){alert("æé†’ï¼šé‡‘é¡è«‹è¼¸å…¥æ•´æ•¸ï¼");return;}
			
			//åŒ¯å…¥è³‡æ–™è‡³item
			var item={
              time: time,
			  type: type,
			  selection: selection,
              cost: cost,
              note: note,
            };
			
			saveData(item);
            	
			//updateæ›´æ–°è³‡æ–™è¡¨
			//updateTable();
			
            //hide dialog
            $('#dialog1').modal('hide');
			
			//clear input/textarea
            $('#year').val('');
            $('#month').val('');
            $('#day').val('');
            $('#selection').val('');
			myForm.type[0].checked=false;
			myForm.type[1].checked=false;
			renew(2)
            $('#cost').val('');
            $('#note').val('');
			
          });
		  
		  //cancel: clear input
		  $('#cancel').click(function(){
            $('#year').val('');
            $('#month').val('');
            $('#day').val('');
			myForm.type[0].checked=false;
			myForm.type[1].checked=false;
            $('#selection').val('');
			renew(2)
            $('#cost').val('');
            $('#note').val('');
		  });
		  
        });
      </script>
	  
	 <script type="text/javascript">
     google.charts.load('current', {'packages':['corechart']});
     google.charts.setOnLoadCallback(drawChart);
      function drawChart() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'brand');
        data.addColumn('number', 'percentage');
        data.addRows([
          ['å®¶æ•™', add[0]],['æ•™å­¸è–ªè³‡', add[1]],['ç ”ç©¶è¨ˆç•«', add[2]],['åŠ©æ•™è–ªè³‡', add[3]],['å·¥è®€é‡‘', add[4]],['å…¶ä»–', add[5]]
        ]);
        
        var options = {'width':500,'height':300};
        var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
        chart.draw(data, options);
      }
	  
	  
      google.charts.setOnLoadCallback(drawChart2);
      function drawChart2() {
        var data2 = new google.visualization.DataTable();
        data2.addColumn('string', 'brand');
        data2.addColumn('number', 'percentage');
        data2.addRows([
          ['æ­£é¤é¤è²»', minus[0]],['é›¶é£Ÿé£²æ–™', minus[1]],['æ—¥ç”¨å“', minus[2]],['äº¤é€šè²»', minus[3]],['å¨›æ¨‚ç¤¾äº¤', minus[4]],['å…¶ä»–', minus[5]]
        ]);
        
        var options2 = {'width':500,'height':300};
        var chart2 = new google.visualization.PieChart(document.getElementById('chart_div2'));
        chart2.draw(data2, options2);
      }
    </script>

	</div>
	<div style="background-color:#FFFFFF;">
		<div class='row' style="background-color:#FFFFFF;">
			<div class='col-6' style="text-align:center;">æ”¶å…¥åœ“é¤…åœ–</div>
			<div class='col-6' style="text-align:center;">æ”¯å‡ºåœ“é¤…åœ–</div>
		</div>
		<div class='row' style="background-color:#FFFFFF;">
			<div class='col-2'></div>
			<div class='col-4' id="chart_div" style="text-align:center;"></div>
			<div class='col-4' id="chart_div2" style="text-align:center;"></div>
			<div class='col-2'></div>
		</div>
	</div>
  </body>
</html>